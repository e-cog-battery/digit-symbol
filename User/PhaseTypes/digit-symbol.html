<style>
  .legend_digit, .column_digit{
  font-size: 20px;
  color: black;
  text-align: center;
  border: 3px solid black;
  width: 150px;
  }

  
  .legend_symbol{
    padding: 20px;
    height: 150px;
    width:  150px;
    border: 3px solid black;
  }
  
  .selected{
    border: 5px solid red;
  }
  
  /*
  .task_symbol{
    display: none;
  }
  */


#task_table{
  /*
  width: 150px;
  height: 200px;
  */
}

#legend_table{
  /*
  width: 150px;
  height: 200px;
  */
}

</style>


<div class="container">
  <div class="row">
    <div class="col">
      <div class="row" id="legend_table"></div>
      <div class="row" style= height:100px></div>
      <div class="row" id="task_table"></div>
    </div>
    <div class="col">
      <div class="row" id="symbol_table"></div>
    </div>
  </div>
</div>
<button class="btn btn-primary" onclick="Phase.submit()" disabled id="submit_btn">Submit</button>


<input type="hidden" id="image_response" name="image_response">

<script>


var home_dir = "";
var org_repo = parent.parent.project_json.location.split("/");
switch (parent.parent.Project.get_vars.platform) {
  case "simulateonline":
  case "localhost":
  case "preview":
    home_dir = parent.parent.Collector.electron.git.locate_repo({
      org: org_repo[0],
      repo: org_repo[1],
    });
    break;
  default:
    home_dir = "..";
    break;
}


Phase.set_timer(function(){
  var this_phase = parent.parent.project_json.phase_no;
  
  var phase_info = parent.parent.project_json.parsed_proc[this_phase];
  
  var no_symbols = parseFloat("{{no_symbols}}");

  legend_symbols = [];
  column_digits = [];
  legend_digits = [];
  
  for(var i = 1; i <= no_symbols; i++){
    legend_symbols.push(home_dir + "/" + phase_info["legend_symbol_" + i]);
    column_digits.push(phase_info["column_digit_" + i]);
    legend_digits.push(phase_info["legend_digit_" + i]);
  }
  
  $("#symbol_table").append(
    legend_symbols.map(function(symbol_item, symbol_index){
      return $("<div>").append(
        $("<img>")
          .addClass("legend_symbol")
          .addClass("symbol_select")
          .prop("id", "symbol_image_" + symbol_index)
          .attr("src",symbol_item)
      )
    })  
  )
  
  
  
  
  $("#legend_table").append(
    $("<table>").append(
      $("<tr>").append(
        legend_digits.map(function(legend_item, legend_index){
          return $("<td>").append(
            $("<div>")
              .addClass("legend_digit")
              .prop("id", "legend_digit_" + legend_index)
              .html(legend_item)
          )
        })
      ),
      
      $("<tr>").append(
        legend_symbols.map(function(legend_item, legend_index){
          return $("<td>").append(
            $("<img>")
              .addClass("legend_symbol")
              .prop("id", "legend_symbol_" + legend_index)
              .attr("src",legend_item)
          )
        })
      )
    )
  );
  $("#task_table").append(
    $("<tr>").append(
      column_digits.map(function(column_item, column_index){
        return $("<td>").append(
          $("<div>")
            .addClass("column_digit")
            .prop("id", "column_digit" + column_index)
            .html(column_item)
        )
      })
    ),
    
    $("<tr>").append(
      legend_symbols.map(function(legend_item, legend_index){
        return $("<td>").append(
          $("<img>")
            .addClass("legend_symbol")
            .addClass("symbol_input")
            .addClass("blankie")
            .prop("id", "legend_symbol_" + legend_index)
            .attr("src","../User/Stimuli/blank.png")
        )
      })
    )
  );
  
  $("symbol_table").append(
    $("<table>").append(
      $("<div class='row'>").append(
        legend_symbols.map(function(legend_item, legend_index){
         return $("<tr>").append(
          $("<img>")
            .addClass("legend_symbol")
            .prop("id", "legend_symbol_" + legend_index)
            .attr("src",legend_item)
           )
        })
      )
    )
  );
  
  
  $(".symbol_input").on("click", function(){
    $(this).prop("src", $(".selected").prop("src"));
    $(this).removeClass("blankie");
    
    var all_responses = [];
    $("#submit_btn").prop("disabled",true);
    
    
    if($(".blankie").length == 0){
      $("#submit_btn").prop("disabled",false);
    }
    
    /*
    for(var i = 0; i < $(".symbol_input").length; i++){
      all_responses.push($(".symbol_input")[i].src);
    }
    
    */
    
    
    $("#image_response").val(all_responses.join(","));
  });
  
  $(".symbol_select").on("click", function(){
    $(".symbol_select").removeClass("selected");  
    $(this).addClass("selected");
  });
  
  $(".task_symbol").on("click", function(){
  
    $(".task_digit").hide();
    $("task_table").hide();
    
    var response = $(this).attr("src");
    $('#response').css({ 'display':'block' });
    
    setTimeout(function(){
      Phase.submit();
    },2000);
  });
  /*
  
  */

  
  
  
}, 0);


// no_symbols	legend_symbol_1	legend_symbol_2	legend_symbol_3	legend_symbol_4	legend_symbol_5	column_digit_1	column_digit_2	column_digit_3	column_digit_4	column_digit_5	legend_digit_1	legend_digit_2	legend_digit_3	legend_digit_4	legend_digit_5	


/*
var legend_symbols = "{{legend_symbols}}".split("|");
var column_digits	 = "{{column_digits}}".split("|");
var 	 = "{{legend_digits}}".split("|");
*/



</script>